- include: std


- py-key:
   name: parser
   code: |
      from std import Parser

      uinput = this['uinput']
      return Parser(this['scope'], this['rules'], uinput)


- py-func:
   name: build
   code: |
      import traceback
      from actl import Project

      while True:
         try:
            this['std', 'build']()
            break
         except Exception:
            traceback.print_exc()
            inp = None
            while inp not in ('y', 'n'):
               inp = input('Continue?: ')
            if inp != 'y':
               break


- py-key:
   name: uinput
   code: |
      import traceback
      from actl import Buffer

      @Buffer.wrap
      def getInput():
         parser = this['parser']

         while True:
            if parser.applyingRule:
               msg = '... '
            else:
               msg = '>>> '
            try:
               yield from input(msg)
               yield '\n'
            except EOFError:
               break

      return getInput()
